<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Splinterlands Cards Easy Automatic Monitoring</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 20px;
            background-color: #121212;
            color: #FFFFFF;
        }
        h1 {
            text-align: center;
        }
        form {
            max-width: 600px;
            margin: 0 auto;
        }
        input[type="text"], select {
            width: 90%;
            padding: 10px;
            margin-bottom: 10px;
            box-sizing: border-box;
            background-color: #333333;
            color: #FFFFFF;
            border: 1px solid #555555;
        }

        #colorFilter,
        #typeFilter,
        #rarityFilter,
        #cardSetFilter,
        #editionFilter {
            width: 18%;
            padding: 10px;
            margin-bottom: 10px;
            box-sizing: border-box;
            background-color: #333333;
            color: #FFFFFF;
            border: 1px solid #555555;
        }

        #colorFilter option,
        #typeFilter option,
        #rarityFilter option,
        #cardSetFilter option,
        #editionFilter option {
            background-color: #333333;
            color: #FFFFFF;
        }

        button {
            background-color: #4CAF50;
            color: white;
            padding: 10px 20px;
            border: none;
            cursor: pointer;
            width: 100%;
        }
        button:hover {
            background-color: #45a049;
        }
        #results {
            margin-top: 20px;
            max-width: 800px;
            margin: 20px auto;
        }
        .user-results {
            margin-bottom: 20px;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            background-color: #1e1e1e;
        }
        table, th, td {
            border: 1px solid #555555;
        }
        th, td {
            padding: 10px;
            text-align: left;
        }
        img.card-image {
            width: 50px;
            height: auto;
        }
        th {
            background-color: #333333;
            position: sticky;
            top: 0;
            z-index: 1;
        }

        body {
            margin: 0;
            padding: 0;
            font-family: Arial, sans-serif;
            background-color: #121212;
            color: #FFFFFF;
            padding-bottom: 150px;
        }

        footer {
            position: fixed;
            bottom: 0;
            left: 0;
            width: 100%;
            background-color: #333333;
            color: #ffffff;
            padding: 10px;
            text-align: center;
            font-size: 16px;
            letter-spacing: 1px;
            line-height: 1.5;
        }

        .footer-content p {
            margin: 5px 0;
            font-size: 14px;
            letter-spacing: 0.5px;
            line-height: 0.4;
        }

        footer sub {
            font-size: 0.8em;
        }

        table {
            width: 110%;
            border-collapse: collapse;
            background-color: #1e1e1e;
            table-layout: fixed;
        }

        th, td {
            border: 1px solid #555555;
            padding: 2px;
            text-align: center;
            vertical-align: middle;
            width: calc(100% / 9);
        }

        .scrollable-container {
            overflow-x: auto;
            max-width: 100%;
            padding-bottom: 20px;
        }

        .scrollable-content {
            width: 200%;
        }
    </style>
</head>
<body>
    <h1>Splinterlands Cards Monitoring</h1>
    <form id="collectionForm">
        <input type="text" id="usernames" name="usernames" placeholder='required usernames (comma-separated)'>

        <input type="checkbox" id="allCheckbox" checked>
        <label for="allCheckbox">All</label><br>

        <label for="cardSetFilter">Card Set:</label>
        <select id="cardSetFilter">
            <option value="">All</option>
            <option value="alpha">Alpha</option>
            <option value="beta">Beta</option>
            <option value="promo">Promo</option>
            <option value="reward">Reward</option>
            <option value="untamed">Untamed</option>
            <option value="dice">Dice</option>
            <option value="gladius">Gladius</option>
            <option value="chaos">Chaos</option>
            <option value="rift">Riftwatchers</option>
            <option value="rebellion">Rebellion</option>
        </select>

        <label for="editionFilter">Edition:</label>
        <select id="editionFilter">
            <option value="">All</option>
            <option value="0">0</option>
            <option value="1">1</option>
            <option value="2">2</option>
            <option value="3">3</option>
            <option value="4">4</option>
            <option value="5">5</option>
            <option value="6">6</option>
            <option value="7">7</option>
            <option value="8">8</option>
            <option value="9">9</option>
            <option value="10">10</option>
            <option value="11">11</option>
            <option value="12">12</option>
            <option value="13">13</option>
            <option value="14">14</option>
            <option value="15">15</option>
        </select>

        <label for="colorFilter">Splinter:</label>
        <select id="colorFilter">
            <option value="">All</option>
            <option value="life">Life</option>
            <option value="earth">Earth</option>
            <option value="water">Water</option>
            <option value="death">Death</option>
            <option value="dragon">Dragon</option>
            <option value="neutral">Neutral</option>
            <option value="fire">Fire</option>
        </select>

        <label for="typeFilter">Type:</label>
        <select id="typeFilter">
            <option value="">All</option>
            <option value="monster">Monster</option>
            <option value="summoner">Summoner</option>
        </select>

        <label for="rarityFilter">Rarity:</label>
        <select id="rarityFilter">
            <option value="">All</option>
            <option value="common">Common</option>
            <option value="rare">Rare</option>
            <option value="epic">Epic</option>
            <option value="legendary">Legendary</option>
        </select>

        <button type="button" onclick="computeCollection()">Compute Collection</button>
    </form>
    <div id="results"></div>

    <footer>
        <div class="footer-content">   
            <p><sub>Developed by:Mitchelle V. dela Cruz</sub> </p>
            <p><sub>Contact: mitchellevdelacruz@gmail.com   ~~~  facebook.com/fb.mitchellevdelacruz</sub> </p>
            <p><sub>IGN: ferexian "you can send support here by sending anything from your heart"</sub> </p>
            <p><sub> &copy; 2024 Splinterlands Cards Easy Automatic Monitoring. All rights reserved.</sub> </p>
        </div>
    </footer>

    <script>
// =============================================================================
// EDIT THESE URLs - Find the correct image URL for each CARD SET and paste here
// Use {CARDNAME} as placeholder for the card name
// =============================================================================
const CARDSET_IMAGE_URLS = {
    'alpha': 'https://d36mxiodymuqjm.cloudfront.net/cards_beta/{CARDNAME}.png',
    'beta': 'https://d36mxiodymuqjm.cloudfront.net/cards_beta/{CARDNAME}.png',
    'promo': 'https://d36mxiodymuqjm.cloudfront.net/cards_promo/{CARDNAME}.png',
    'reward': 'https://d36mxiodymuqjm.cloudfront.net/cards_reward/{CARDNAME}.png',
    'untamed': 'https://d36mxiodymuqjm.cloudfront.net/cards_untamed/{CARDNAME}.png',
    'dice': 'https://d36mxiodymuqjm.cloudfront.net/cards_dice/{CARDNAME}.png',
    'gladius': 'https://d36mxiodymuqjm.cloudfront.net/cards_gladius/{CARDNAME}.png',
    'chaos': 'https://d36mxiodymuqjm.cloudfront.net/cards_soulbound/{CARDNAME}.jpg',
    'rift': 'https://d36mxiodymuqjm.cloudfront.net/cards_riftwatchers/{CARDNAME}.png',
    'rebellion': 'https://d36mxiodymuqjm.cloudfront.net/cards_rebellion/{CARDNAME}.png',
};
// =============================================================================

let cardDetails = {};

async function fetchCardDetails() {
    try {
        const response = await fetch('https://api.splinterlands.io/cards/get_details');
        const data = await response.json();
        data.forEach(card => {
            cardDetails[card.id] = card;
        });
    } catch (error) {
        alert('Error fetching card details.');
        console.error(error);
    }
}

function getRarityText(rarity) {
    switch (rarity) {
        case 1:
            return 'common';
        case 2:
            return 'rare';
        case 3:
            return 'epic';
        case 4:
            return 'legendary';
        default:
            return 'unknown';
    }
}

function getColorText(color) {
    switch (color.toLowerCase()) {
        case 'white':
            return 'life';
        case 'green':
            return 'earth';
        case 'blue':
            return 'water';
        case 'black':
            return 'death';
        case 'gold':
            return 'dragon';
        case 'gray':
            return 'neutral';
        case 'red':
            return 'fire';
        default:
            return color;
    }
}

function getImageUrl(cardName, cardSet) {
    const urlTemplate = CARDSET_IMAGE_URLS[cardSet] || CARDSET_IMAGE_URLS['beta'];
    return urlTemplate.replace('{CARDNAME}', cardName);
}

async function computeCollection() {
    const button = document.querySelector('button');
    button.textContent = 'Processing usernames...';
    button.disabled = true;

    const usernames = document.getElementById('usernames').value.split(',').map(name => name.trim().toLowerCase());

    const allCheckbox = document.getElementById('allCheckbox').checked;
    const resultsDiv = document.getElementById('results');
    resultsDiv.innerHTML = '';

    const colorFilter = document.getElementById('colorFilter').value;
    const typeFilter = document.getElementById('typeFilter').value.toLowerCase();
    const rarityFilter = document.getElementById('rarityFilter').value;
    const cardSetFilter = document.getElementById('cardSetFilter').value;
    const editionFilter = document.getElementById('editionFilter').value;

    let allCardsAggregate = {};

    for (const username of usernames) {
        let cardAggregates = {};

        try {
            const response = await fetch(`https://api.splinterlands.io/cards/collection/${username}`);
            const data = await response.json();

            data.cards.forEach(card => {
                const cardDetail = cardDetails[card.card_detail_id] || {};
                const cardName = cardDetail.name || 'N/A';

                // Filter by card set (determines image folder)
                if (cardSetFilter && card.card_set !== cardSetFilter) {
                    return;
                }

                // Filter by edition (subcategory within card set)
                if (editionFilter && card.edition.toString() !== editionFilter) {
                    return;
                }

                const color = getColorText(cardDetail.color);
                const rarity = getRarityText(cardDetail.rarity);
                const type = cardDetail.type || 'N/A';

                if ((colorFilter && color !== colorFilter) ||
                    (typeFilter && type.toLowerCase() !== typeFilter) ||
                    (rarityFilter && rarity !== rarityFilter)) {
                    return;
                }

                if (!cardAggregates[cardName]) {
                    cardAggregates[cardName] = {
                        name: cardName,
                        color: color,
                        rarity: rarity,
                        type: type,
                        cardSet: card.card_set,
                        edition: card.edition,
                        regularCollectionPower: 0,
                        goldCollectionPower: 0,
                        regularBCX: 0,
                        goldBCX: 0,
                        maxRegularCards: 0,
                        maxGoldCards: 0
                    };
                }

                if (!allCardsAggregate[cardName]) {
                    allCardsAggregate[cardName] = {
                        name: cardName,
                        color: color,
                        rarity: rarity,
                        type: type,
                        cardSet: card.card_set,
                        edition: card.edition,
                        regularCollectionPower: 0,
                        goldCollectionPower: 0,
                        regularBCX: 0,
                        goldBCX: 0,
                        maxRegularCards: 0,
                        maxGoldCards: 0
                    };
                }

                if (card.gold) {
                    cardAggregates[cardName].goldCollectionPower += card.collection_power;
                    cardAggregates[cardName].goldBCX += card.xp;

                    allCardsAggregate[cardName].goldCollectionPower += card.collection_power;
                    allCardsAggregate[cardName].goldBCX += card.xp;
                } else {
                    cardAggregates[cardName].regularCollectionPower += card.collection_power;
                    cardAggregates[cardName].regularBCX += card.xp;

                    allCardsAggregate[cardName].regularCollectionPower += card.collection_power;
                    allCardsAggregate[cardName].regularBCX += card.xp;
                }
            });

            Object.keys(cardAggregates).forEach(cardName => {
                const card = cardAggregates[cardName];
                card.maxRegularCards = computeMaxCards(card.rarity, card.regularBCX);
                card.maxGoldCards = computeMaxCards(card.rarity, card.goldBCX, true);
            });

            Object.keys(allCardsAggregate).forEach(cardName => {
                const card = allCardsAggregate[cardName];
                card.maxRegularCards = computeMaxCards(card.rarity, card.regularBCX);
                card.maxGoldCards = computeMaxCards(card.rarity, card.goldBCX, true);
            });

            if (!allCheckbox) {
                displayCardData(cardAggregates, resultsDiv, username);
            }

        } catch (error) {
            alert(`Error fetching collection data for ${username}. Please check your username and try again.`);
            console.error(error);
        }
    }

    if (allCheckbox) {
        displayAggregatedCardData(Object.values(allCardsAggregate), resultsDiv);
    }

    button.textContent = 'Compute Collection';
    button.disabled = false;
}

function computeMaxCards(rarity, bcx, isGold = false) {
    let divisor;
    switch (rarity) {
        case 'common':
            divisor = isGold ? 38 : 400;
            break;
        case 'rare':
            divisor = isGold ? 22 : 115;
            break;
        case 'epic':
            divisor = isGold ? 10 : 46;
            break;
        case 'legendary':
            divisor = isGold ? 4 : 11;
            break;
        default:
            divisor = 1;
    }
    return Math.floor(bcx / divisor);
}

function displayCardData(cardAggregates, resultsDiv, username) {
    const userDiv = document.createElement('div');
    userDiv.className = 'user-results';
    userDiv.innerHTML = `<h2>Collection for ${username}</h2>`;

    const table = document.createElement('table');
    const headerRow = document.createElement('tr');
    headerRow.innerHTML = `
        <th>Image</th>
        <th>Name</th>
        <th>Splinter</th>
        <th>Rarity</th>
        <th>Type</th>
        <th>Regular</th>
        <th>Gold</th>
        <th>Max Regular</th>
        <th>Max Gold</th>
    `;
    table.appendChild(headerRow);

    Object.values(cardAggregates).forEach(cardAggregate => {
        const imageUrl = getImageUrl(cardAggregate.name, cardAggregate.cardSet);
        const row = document.createElement('tr');
        row.innerHTML = `
            <td><img src="${imageUrl}" alt="${cardAggregate.name}" class="card-image"></td>
            <td>${cardAggregate.name}</td>
            <td>${cardAggregate.color}</td>
            <td>${cardAggregate.rarity}</td>
            <td>${cardAggregate.type}</td>
            <td>${cardAggregate.regularBCX}</td>
            <td>${cardAggregate.goldBCX}</td>
            <td>${cardAggregate.maxRegularCards}</td>
            <td>${cardAggregate.maxGoldCards}</td>
        `;
        table.appendChild(row);
    });

    userDiv.appendChild(table);
    resultsDiv.appendChild(userDiv);
}

function displayAggregatedCardData(aggregatedCardData, resultsDiv) {
    const aggregatedDiv = document.createElement('div');
    aggregatedDiv.className = 'user-results';
    aggregatedDiv.innerHTML = `<h2>Total Cards Collection</h2>`;

    const table = document.createElement('table');
    const headerRow = document.createElement('tr');
    headerRow.innerHTML = `
        <th>Image</th>
        <th>Name</th>
        <th>Splinter</th>
        <th>Rarity</th>
        <th>Type</th>
        <th>Regular</th>
        <th>Gold</th>
        <th>Max Regular Cards</th>
        <th>Max Gold Cards</th>
    `;
    table.appendChild(headerRow);

    aggregatedCardData.forEach(cardAggregate => {
        const imageUrl = getImageUrl(cardAggregate.name, cardAggregate.cardSet);
        const row = document.createElement('tr');
        row.innerHTML = `
            <td><img src="${imageUrl}" alt="${cardAggregate.name}" class="card-image"></td>
            <td>${cardAggregate.name}</td>
            <td>${cardAggregate.color}</td>
            <td>${cardAggregate.rarity}</td>
            <td>${cardAggregate.type}</td>
            <td>${cardAggregate.regularBCX}</td>
            <td>${cardAggregate.goldBCX}</td>
            <td>${cardAggregate.maxRegularCards}</td>
            <td>${cardAggregate.maxGoldCards}</td>
        `;
        table.appendChild(row);
    });

    aggregatedDiv.appendChild(table);
    resultsDiv.appendChild(aggregatedDiv);
}

fetchCardDetails();
    </script>
</body>
</html>